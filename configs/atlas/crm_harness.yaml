agent:
  type: crm_harness
  name: crm-benchmark-student
  system_prompt: |
    You are the Arc CRM benchmark harness. Execute the ground-truth conversation exactly as specified,
    using the Postgres backend to enforce production validation rules. Do not invent tool calls.
  tools: []
  backend: postgres          # Enforced inside the adapter to guarantee Postgres realism
  use_llm_judge: true

teacher:
  llm:
    provider: openai
    model: gpt-4.1
    api_key_env: OPENAI_API_KEY
    temperature: 0.05
    max_output_tokens: 2048
  plan_cache_seconds: 180

student:
  tool_choice: auto

orchestration:
  forced_mode: paired        # Disable capability probe; run single-shot + teacher validation at the end
  max_retries: 0

adaptive_teaching:
  enabled: false

rim:
  small_model:
    provider: openai
    model: gpt-4.1-mini
    api_key_env: OPENAI_API_KEY
    max_output_tokens: 512
  large_model:
    provider: openai
    model: gpt-4.1
    api_key_env: OPENAI_API_KEY
    max_output_tokens: 2048
  judge_prompt: |
    Reward runs that reach the correct CRM state, follow required tools, and stay safe.
  variance_threshold: 0.15
  uncertainty_threshold: 0.30

learning:
  llm:
    provider: gemini
    model: gemini/gemini-2.5-flash
    api_key_env: GEMINI_API_KEY
    temperature: 0.05
    max_output_tokens: 2048
    timeout_seconds: 60
  history_limit: 5
  apply_to_prompts: true
  prompts:
    synthesizer: |
      Role: CRM learning synthesizer. Respond with ONLY valid JSON (no markdown fences) matching:
      {
        "student_pamphlet": string|null,
        "teacher_pamphlet": string|null,
        "session_student_learning": string|null,
        "session_teacher_learning": string|null,
        "playbook_entries": [playbook_entry.v1 objects],
        "metadata": object|null
      }

      Each playbook_entry.v1 object MUST follow:
      {
        "id": string|null,
        "audience": "student",
        "cue": {"type": "keyword"|"regex", "pattern": "<machine-detectable trigger>", "description": string|null},
        "action": {
          "imperative": "<<=120 chars>",
          "runtime_handle": "<handle from available_runtime_handles>",
          "tool_name": "<same as runtime_handle>",
          "arguments": object|null
        },
        "expected_effect": "<<=200 chars describing measurable impact>",
        "scope": {
          "category": "reinforcement",
          "constraints": "<<=250 chars describing applicability bounds>",
          "applies_when": string|null
        },
        "metadata": object|null
      }

      Guidelines:
      - Only use runtime handles provided in available_runtime_handles (CRM tools such as client_search, modify_client, upload_document, etc.). If no handle applies, omit the entry.
      - Cues must be reusable CRM language (e.g., "update the quote amount") or safe regexes; avoid task-specific IDs, timestamps, or company/account numbers.
      - Arguments should describe structured input expectations (e.g., {"client_id": "<id>"}) rather than literal data.
      - Use session_student_learning / session_teacher_learning for short natural-language lessons (<200 chars) describing what changed this run.
      - If reward/trajectory data does not justify a safe entry, return an empty playbook_entries array but still emit the outer object.
      - Keep JSON strict: double quotes, no comments, no trailing commas.
  schema:
    allowed_runtime_handles:
      - client_search
      - opportunity_search
      - quote_search
      - contract_search
      - contact_search
      - company_search
      - create_new_client
      - create_new_opportunity
      - create_contract
      - create_quote
      - create_new_contact
      - upload_document
      - add_note
      - modify_client
      - modify_opportunity
      - modify_quote
      - modify_contact
    cue_types:
      - keyword
      - regex
    default_scope_category: reinforcement
  gates:
    enforce_actionability: true
    enforce_cue: true
    enforce_generality: true
    max_text_length: 320
    allowed_proper_nouns:
      - CRM
      - Atlas
      - SQL
      - API
      - JSON
    banned_incident_tokens:
      - incident
      - ticket
      - case
      - postmortem
    allow_length_overflow_margin: 0
  usage_tracking:
    enabled: true
    capture_examples: true
    max_examples_per_entry: 3

storage:
  database_url: postgresql://atlas:atlas@localhost:5433/atlas
  min_connections: 1
  max_connections: 5
  statement_timeout_seconds: 30
